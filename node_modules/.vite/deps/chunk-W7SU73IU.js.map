{
  "version": 3,
  "sources": ["../../@supabase/functions-js/src/helper.ts", "../../@supabase/functions-js/src/types.ts", "../../@supabase/functions-js/src/FunctionsClient.ts"],
  "sourcesContent": ["import { Fetch } from './types'\r\n\r\nexport const resolveFetch = (customFetch?: Fetch): Fetch => {\r\n  let _fetch: Fetch\r\n  if (customFetch) {\r\n    _fetch = customFetch\r\n  } else if (typeof fetch === 'undefined') {\r\n    _fetch = async (...args) => await (await import('cross-fetch')).fetch(...args)\r\n  } else {\r\n    _fetch = fetch\r\n  }\r\n  return (...args) => _fetch(...args)\r\n}\r\n", "export type Fetch = typeof fetch\r\n\r\n/**\r\n * Response format\r\n *\r\n */\r\nexport interface FunctionsResponseSuccess<T> {\r\n  data: T\r\n  error: null\r\n}\r\nexport interface FunctionsResponseFailure {\r\n  data: null\r\n  error: any\r\n}\r\nexport type FunctionsResponse<T> = FunctionsResponseSuccess<T> | FunctionsResponseFailure\r\n\r\nexport class FunctionsError extends Error {\r\n  context: any\r\n  constructor(message: string, name = 'FunctionsError', context?: any) {\r\n    super(message)\r\n    this.name = name\r\n    this.context = context\r\n  }\r\n}\r\n\r\nexport class FunctionsFetchError extends FunctionsError {\r\n  constructor(context: any) {\r\n    super('Failed to send a request to the Edge Function', 'FunctionsFetchError', context)\r\n  }\r\n}\r\n\r\nexport class FunctionsRelayError extends FunctionsError {\r\n  constructor(context: any) {\r\n    super('Relay Error invoking the Edge Function', 'FunctionsRelayError', context)\r\n  }\r\n}\r\n\r\nexport class FunctionsHttpError extends FunctionsError {\r\n  constructor(context: any) {\r\n    super('Edge Function returned a non-2xx status code', 'FunctionsHttpError', context)\r\n  }\r\n}\r\n\r\nexport type FunctionInvokeOptions = {\r\n  /**\r\n   * Object representing the headers to send with the request.\r\n   * */\r\n  headers?: { [key: string]: string }\r\n  /**\r\n   * The HTTP verb of the request\r\n   */\r\n  method?: 'POST' | 'GET' | 'PUT' | 'PATCH' | 'DELETE'\r\n  /**\r\n   * The body of the request.\r\n   */\r\n  body?:\r\n    | File\r\n    | Blob\r\n    | ArrayBuffer\r\n    | FormData\r\n    | ReadableStream<Uint8Array>\r\n    | Record<string, any>\r\n    | string\r\n}\r\n", "import { resolveFetch } from './helper'\r\nimport {\r\n  Fetch,\r\n  FunctionsFetchError,\r\n  FunctionsHttpError,\r\n  FunctionsRelayError,\r\n  FunctionsResponse,\r\n  FunctionInvokeOptions,\r\n} from './types'\r\n\r\nexport class FunctionsClient {\r\n  protected url: string\r\n  protected headers: Record<string, string>\r\n  protected fetch: Fetch\r\n\r\n  constructor(\r\n    url: string,\r\n    {\r\n      headers = {},\r\n      customFetch,\r\n    }: {\r\n      headers?: Record<string, string>\r\n      customFetch?: Fetch\r\n    } = {}\r\n  ) {\r\n    this.url = url\r\n    this.headers = headers\r\n    this.fetch = resolveFetch(customFetch)\r\n  }\r\n\r\n  /**\r\n   * Updates the authorization header\r\n   * @param token - the new jwt token sent in the authorisation header\r\n   */\r\n  setAuth(token: string) {\r\n    this.headers.Authorization = `Bearer ${token}`\r\n  }\r\n\r\n  /**\r\n   * Invokes a function\r\n   * @param functionName - The name of the Function to invoke.\r\n   * @param options - Options for invoking the Function.\r\n   */\r\n  async invoke<T = any>(\r\n    functionName: string,\r\n    options: FunctionInvokeOptions = {}\r\n  ): Promise<FunctionsResponse<T>> {\r\n    try {\r\n      const { headers, method, body: functionArgs } = options\r\n\r\n      let _headers: Record<string, string> = {}\r\n      let body: any\r\n      if (\r\n        functionArgs &&\r\n        ((headers && !Object.prototype.hasOwnProperty.call(headers, 'Content-Type')) || !headers)\r\n      ) {\r\n        if (\r\n          (typeof Blob !== 'undefined' && functionArgs instanceof Blob) ||\r\n          functionArgs instanceof ArrayBuffer\r\n        ) {\r\n          // will work for File as File inherits Blob\r\n          // also works for ArrayBuffer as it is the same underlying structure as a Blob\r\n          _headers['Content-Type'] = 'application/octet-stream'\r\n          body = functionArgs\r\n        } else if (typeof functionArgs === 'string') {\r\n          // plain string\r\n          _headers['Content-Type'] = 'text/plain'\r\n          body = functionArgs\r\n        } else if (typeof FormData !== 'undefined' && functionArgs instanceof FormData) {\r\n          // don't set content-type headers\r\n          // Request will automatically add the right boundary value\r\n          body = functionArgs\r\n        } else {\r\n          // default, assume this is JSON\r\n          _headers['Content-Type'] = 'application/json'\r\n          body = JSON.stringify(functionArgs)\r\n        }\r\n      }\r\n\r\n      const response = await this.fetch(`${this.url}/${functionName}`, {\r\n        method: method || 'POST',\r\n        // headers priority is (high to low):\r\n        // 1. invoke-level headers\r\n        // 2. client-level headers\r\n        // 3. default Content-Type header\r\n        headers: { ..._headers, ...this.headers, ...headers },\r\n        body,\r\n      }).catch((fetchError) => {\r\n        throw new FunctionsFetchError(fetchError)\r\n      })\r\n\r\n      const isRelayError = response.headers.get('x-relay-error')\r\n      if (isRelayError && isRelayError === 'true') {\r\n        throw new FunctionsRelayError(response)\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new FunctionsHttpError(response)\r\n      }\r\n\r\n      let responseType = (response.headers.get('Content-Type') ?? 'text/plain').split(';')[0].trim()\r\n      let data: any\r\n      if (responseType === 'application/json') {\r\n        data = await response.json()\r\n      } else if (responseType === 'application/octet-stream') {\r\n        data = await response.blob()\r\n      } else if (responseType === 'multipart/form-data') {\r\n        data = await response.formData()\r\n      } else {\r\n        // default to text\r\n        data = await response.text()\r\n      }\r\n\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
